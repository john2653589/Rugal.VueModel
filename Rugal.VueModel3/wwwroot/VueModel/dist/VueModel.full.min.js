function AddTaskLoop(n,t=1e3){return setInterval(n,t)}function VerifyVueJs(){try{Vue}catch(n){throw"Vue.js is not found, should include Vue.js before include VueModel";}}class CommonFunc{constructor(){this.Id=this._GenerateId();this.NavigateToFunc=null}WithNavigateToFunc(n){return this.NavigateToFunc=n,this}_HasAnyKeys(n){let t=Object.keys(n);return t.length>0}_ForEachKeyValue(n,t=()=>{}){let i=Object.keys(n);for(let r=0;r<i.length;r++){let u=i[r],f=n[u];t!=null&&t.call(this,u,f)}}_IsNullOrEmpty(n){return n==null||n==""?!0:!1}_Throw(n){throw new Error(n);}_Error(n){console.log(n)}_GenerateId(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,n=>(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16))}_IsString(n){return typeof n=="string"}_ReadImageBase64(n,t=()=>{}){let i=new FileReader;i.onload=()=>{let n=i.result;t(n)};i.readAsDataURL(n)}_Base64ToFile(n,t){let r=n.split(","),e=r[0].match(/:(.*?);/)[1],u=atob(r[r.length-1]),i=u.length,f=new Uint8Array(i);while(i--)f[i]=u.charCodeAt(i);return new File([f],t,{type:e})}_DeepObjectExtend(n,t,i=10){if(i==0)return{...n,...t};let r=Object.keys(t);for(let u=0;u<r.length;u++){let f=r[u];if(f in n)if(typeof t[f]!="object")n[f]=t[f];else{let r={...this._DeepObjectExtend(n[f],t[f],i-1)};n[f]=r}else n[f]=t[f]}return n}GetDate(){let n=new Date,t=n.getFullYear(),i=n.getMonth()+1,r=n.getDate();return{Year:t,Month:i,Day:r}}GetDateTime(){let n=this.GetDate(),t=new Date,i=t.getHours(),r=t.getMinutes(),u=t.getSeconds();return{Year:n.Year,Month:n.Month,Day:n.Day,Hour:i,Min:r,Sec:u}}ToDateText(n,t={IsFillZero:true,Separator:"-"}){let{Year:u,Month:i,Day:r}=n;t.IsFillZero&&(i=i.toString().padStart(2,"0"));t.IsFillZero&&(r=r.toString().padStart(2,"0"));let f=[u,i,r];return f.join(t.Separator)}ToDateTimeText(n,t={IsFillZero:true,DateSeparator:"-",TimeSeparator:":"}){let{Year:o,Month:f,Day:e,Hour:i,Min:r,Sec:u}=n;t.IsFillZero&&(f=f.toString().padStart(2,"0"));t.IsFillZero&&(e=e.toString().padStart(2,"0"));i??=0;t.IsFillZero&&(i=i.toString().padStart(2,"0"));r??=0;t.IsFillZero&&(r=r.toString().padStart(2,"0"));u??=0;t.IsFillZero&&(u=u.toString().padStart(2,"0"));let s=[o,f,e],h=s.join(t.DateSeparator),c=[i,r,u],l=c.join(t.TimeSeparator);return`${h} ${l}`}GetDateText(n={IsFillZero:true,Separator:"-"}){let t=this.GetDate();return this.ToDateText(t,n)}GetDateTimeText(n={IsFillZero:true,DateSeparator:"-",TimeSeparator:":"}){let t=this.GetDateTime();return this.ToDateTimeText(t,n)}_CompareSortBy(n,t){return(i,r)=>{let u=t?-1:1;return i[n]<r[n]?-1*u:i[n]>r[n]?1*u:0}}NavigateTo(n=[],t=null){Array.isArray(n)||(n=[n]);let r=n[0][0]=="/",i=n.map(n=>this._GetClearUrl(n)).join("/");r&&(i=`/${i}`);t!=null&&(typeof t!="string"&&(t=this._ConvertTo_UrlQuery(t)),i+=`?${t}`);window.location.href=i}}class DomEditor{constructor(n=null){this.Id=this._GenerateId();this.QueryParams=[];this._Props={Doms:[]};this.Doms=n}get NodeList(){let n=[];for(let t of[...document.children])this._RCS_Visit(t,n);return n}get Doms(){return this._NeedQuery(),this._Props.Doms}set Doms(n){if(n!=null)if(n instanceof NodeList)this._Props.Doms=[...n];else if(n instanceof HTMLCollection)this._Props.Doms=[...n];else if(n instanceof Element)this._Props.Doms=[n];else if(Array.isArray(n))this._Props.Doms=n;else throw new Error("error doms type");}NewWithElement(n=[]){return Array.isArray(n)||(n=[n]),new DomEditor(n)}WithId(n){let t=this._QueryString_Id(n);return this.QueryParams.push(t),this}WithAttr(n,t=null){let i=this._CheckAttr(n,t);return this.QueryParams.push(`[${i}]`),this}WithAll(){return this.QueryParams.push("*"),this}WithCustom(n){return this.QueryParams.push(n),this}Query(){if(this.QueryParams.length==0)throw new Error("query params is empty");let n=this.QueryParams.join(" ");return this.Doms=this.NodeList.filter(t=>t.matches(n)),this.QueryParams=[],this}WhereId(n){let t=this._QueryString_Id(n);return this._BaseWhere(t),this}WhereAttr(n,t=null){let i=this._CheckAttr(n,t);return this._BaseWhere(`[${i}]`),this}WhereTagName(){let n=this._CheckAttr(AttrName,AttrValue);return this._BaseWhere(`[${n}]`),this}WhereCustom(n){return this._BaseWhere(n),this}SetAttr(n,t){return this.Doms.forEach(i=>{this.SetElement_Attr(i,n,t)}),this}SetElement_Attr(n,t,i){if(!n instanceof Element)throw new Error("error element param type");return n.setAttribute(t,i),this}GetElement_Attr(n,t){if(!n instanceof Element)throw new Error("error element param type");return n.getAttribute(t)}_QueryString_Id(n){return this._QueryString_Attr("id",n)}_QueryString_VcCol(n){return this._QueryString_Attr("vc-col",n)}_QueryString_Attr(n,t=null){let i=`[${n}]`;return t!=null&&(i=`[${n}="${t}"]`),i}_QueryString_Attr_WithVcName(n,t,i=null){let r=`[vc-name="${n}"]`,u=this._QueryString_Attr(t,i);return`${r} ${u}`}_NeedQuery(){this.QueryParams.length>0&&this.Query()}_CheckAttr(n,t){let i=n;return t!=null&&(i=`${n}="${t}"`),i}First(){return this._NeedQuery(),this.Doms[0]}ForEach(n){return this._BaseFor(t=>{n?.call(this,t)}),this}_BaseFor(n){for(let t=0;t<this.Doms.length;t++){let i=this.Doms[t];n?.call(this,i)}}_BaseWhere(n){this._NeedQuery();this.Doms=this.Doms.filter(t=>t.matches(n))}_GenerateId(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,n=>(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16))}_RCS_Visit(n,t){t.push(n);let i=n.children;if(n.tagName=="TEMPLATE"&&(i=n.content.children),i)for(let n of[...i])this._RCS_Visit(n,t)}}VerifyVueJs();const{createApp}=Vue,Dom=new DomEditor;class VueModel extends CommonFunc{constructor(){super();this._Store={FileStore:{}};this.ApiStore={};this.VueOption={methods:{},components:{},watch:{}};this.VueProxy=null;this.Vue=null;this.VueUse=[];this.BindElementId="BindApp";this.DefaultStoreKey="Default";this.WithDefaultStore(this.DefaultStoreKey);this.IsInited=!1;this.GetToken=null;this.FuncKey_FormatDate="Format_Date";this._Domain=null;this._Token=null;this._Func_ConvertTo_FormParam=[];this._Funcs_Mounted=[];this.FileExtensionCheckOption={IsCheck:!1,IsAlert:!1,ErrorMessage:"Error file extension"}}get Function(){return this.VueProxy?.$options?.methods??this.VueOption.methods}get Dom(){return new DomEditor}get Domain(){return this._Domain==null?null:this._GetClearDomain(this._Domain)}set Domain(n){this._Domain=this._GetClearDomain(n)}get FileStore(){return this.Store.FileStore}get Store(){let n=this.VueProxy?.$data;return n??this._Store}Init(){if(!this.IsInited){let n=this._Store,t=this._Funcs_Mounted,i={...this.VueOption,data(){return n},mounted:()=>{for(let n of t)n()}};this.Vue=createApp(i);for(let n of this.VueUse)this.Vue.use(n);this.VueProxy=this.Vue.mount(`#${this.BindElementId}`);this.IsInited=!0}return this}WithDefaultStore(n){return this.DefaultStoreKey=n,this.Store[this.DefaultStoreKey]??={},this}WithStoreData(n){return this.Store=n,this}WithRootId(n="BindApp"){return this.BindElementId=n,this}WithVueOption(n={}){return this.VueOption=this._DeepObjectExtend(this.VueOption,n),this}WithComponent(n={}){return this.VueOption.components=this._DeepObjectExtend(this.VueOption.components,n),this}WithMounted(n=()=>{}){return this._Funcs_Mounted.push(n),this}WithDomain(n){return this.Domain=n,this}WithToken(n){return this._Token=n,this}WithConvertTo_FormParam(n=()=>{}){return this._Func_ConvertTo_FormParam.push(n),this}WithJsonFormParam(n="Result"){return this.WithConvertTo_FormParam(t=>{let i={};return i[n]=JSON.stringify(t),i}),this}WithFileExtensionCheck(n={IsAlert:false,ErrorMessage:null}){return this.FileExtensionCheckOption.IsCheck=!0,this.FileExtensionCheckOption.IsAlert=n.IsAlert,this._IsNullOrEmpty(n.ErrorMessage)||(this.FileExtensionCheckOption.ErrorMessage=n.ErrorMessage),this}WithVueUse(...n){for(let t of n)this.VueUse.push(t);return this}Using(n=()=>{}){return n(),this}AddV_Text(n,t=null){return this.AddVdom_Text(this.Dom.WithId(n),t??n),this}AddVq_Text(n,t=null){return this.AddVdom_Text(this.Dom.WithCustom(n),t),this}AddVcol_Text(n,t=null){return this.AddVdom_Text(this.Dom.WithAttr("vc-col",n),t??n),this}AddVdom_Text(n,t){let i=this._BaseCheck_DomEditor(n);return t=this._ReCombineStoreKey(t),this.AddStore(t,null),i.SetAttr("v-text",t),this}AddV_Input(n,t=null,i={VModelKey:null,IsReCombineStore:true}){return this.AddVdom_Input(this.Dom.WithId(n),t??n,i),this}AddVq_Input(n,t=null,i={VModelKey:null,IsReCombineStore:true}){return this.AddVdom_Input(this.Dom.WithCustom(n),t,i),this}AddVcol_Input(n,t=null,i={VModelKey:null,IsReCombineStore:true}){return this.AddVdom_Input(this.Dom.WithAttr("vc-col",n),t??n,i),this}AddVdom_Input(n,t,i={VModelKey:null,IsReCombineStore:true}){let r=this._BaseCheck_DomEditor(n);return i.IsReCombineStore&&(t=this._ReCombineStoreKey(t)),this.AddStore(t,null),r.ForEach(n=>{let u="v-model";this._IsNullOrEmpty(i.VModelKey)||(u+=`:${i.VModelKey}`);switch(n.type){case"datetime":case"datetime-local":case"date":this.AddVdom_Format(r,this.FuncKey_FormatDate,t,`'${t}'`);break;case"number":u="v-model.number"}r.SetElement_Attr(n,u,t)}),this}AddV_Select(n={SelectId:null,From:null,To:null,OptionId:null,Display:null,Value:null,Default:null}){let t=this.Dom._QueryString_Id(n.SelectId),i=this.Dom._QueryString_Id(n.OptionId);return this.AddVq_Select({SelectQuery:t,OptionQuery:i,From:n.From,To:n.To,Display:n.Display,Value:n.Value}),this}AddVcol_Select(n={SelectCol:null,OptionCol:null,From:null,To:null,Display:null,Value:null,Default:null}){n.From=n.From??n.SelectCol;n.To=n.To??n.SelectCol;let t=this.Dom._QueryString_VcCol(n.SelectCol),i=this.Dom._QueryString_VcCol(n.OptionCol);return this.AddVq_Select({SelectQuery:t,OptionQuery:i,From:n.From,To:n.To,Display:n.Display,Value:n.Value}),this}AddVq_Select(n={SelectQuery:null,From:null,To:null,OptionQuery:null,Display:null,Value:null,Default:null}){return this.AddStore(this._ReCombineStoreKey(n.To),n.Default),this.UpdateStore([],n.From,!0),this.Dom.WithCustom(n.SelectQuery).ForEach(t=>{if(n.From.toLowerCase()!="-html"){let i=this._ReCombineItemKey(n.Display),r=this._ReCombineItemKey(n.Value);this.Dom.NewWithElement([...t.children]).WhereCustom(n.OptionQuery).SetAttr("v-text",i).SetAttr(":value",r).SetAttr("v-for",`(Item, Idx) in ${n.From}`)}let i=this._ReCombineStoreKey(n.To);this.Dom.SetElement_Attr(t,"v-model",i)}),this}AddV_SelectHtml(n,t){return this.AddVdom_SelectHtml(this.Dom.WithId(n),t??n),this}AddVq_SelectHtml(n,t){return this.AddVdom_SelectHtml(this.Dom.WithCustom(n),t),this}AddVdom_SelectHtml(n,t){t=this._ReCombineStoreKey(t);this.AddStore(t,null);let i=this._BaseCheck_DomEditor(n);return i.SetAttr("v-model",t),this}AddV_Checkbox(n,t=null,i={Value:null,Multi:false,IsChecked:false}){return this.AddVdom_Checkbox(this.Dom.WithId(n),t??n,i),this}AddVq_Checkbox(n,t=null,i={Value:null,Multi:false,IsChecked:false}){return this.AddVdom_Checkbox(this.Dom.WithCustom(n),t,i),this}AddVcol_Checkbox(n,t=null,i={Value:null,Multi:false,IsChecked:false}){return this.AddVdom_Checkbox(this.Dom.WithAttr("vc-col",n),t??n,i),this}AddVdom_Checkbox(n,t,i={Value:null,Multi:false,IsChecked:false}){let u=this._BaseCheck_DomEditor(n),f=i.Multi?[]:i.IsChecked;this.AddStore(t,f);this.AddVdom_Input(n,t,{IsReCombineStore:!1});let r=i.Value;return i.Multi?u.ForEach(n=>{if(r==null){let t=n.value=="on"||this._IsNullOrEmpty(n.value);t&&(r=`"${n.getAttribute("vc-col")}"`)}if(this.AddVdom_Bind(new DomEditor(n),"value",r),i.IsChecked){let n=this.Store[t],i=r.replaceAll('"',"").replaceAll("'","");n.includes(i)||n.push(i)}}):r!=null&&this.AddVdom_Bind(u,"value",r),this}AddVfor_Checkbox(n={Checkbox:null,From:null,To:null,Value:null,Display:null,Of:null,Label:null}){let t=this._ReCombineItemKey(n.Display),i=this._ReCombineItemKey(n.Value);return this.AddVcol_Checkbox(n.Checkbox,n.To,{Value:i,Multi:!0}),this.AddVcol_For(n.Of,n.From),this.AddVcol_Text(n.Label,t),this}AddV_For(n,t,i=null){return this.AddVdom_For(this.Dom.WithId(n),t??n,i),this}AddVq_For(n,t,i=null){return this.AddVdom_For(this.Dom.WithCustom(n),t,i),this}AddVcol_For(n,t,i=null){return this.AddVdom_For(this.Dom.WithAttr("vc-col",n),t,i),this}AddVdom_For(n,t,i=null){let r=this._RCS_GetStore(t,this.Store);r==null?this.AddStore(t,[]):Array.isArray(r)||this.UpdateStore([],t,!0);i??="(Item, Idx)";let u=this._BaseCheck_DomEditor(n);return u.SetAttr("v-for",`${i} in ${t}`),this}AddV_File(n,t=null,i={IsAddMode:false,ConverFileFunc:null}){return this.AddVdom_File(this.Dom.WithId(n),t??n,i),this}AddVq_File(n,t=null,i={IsAddMode:false,ConverFileFunc:null}){return this.AddVdom_File(this.Dom.WithCustom(n),t,i),this}AddVcol_File(n,t=null,i={IsAddMode:false,ConverFileFunc:null}){return this.AddVdom_File(this.Dom.WithAttr("vc-col",n),t??n,i),this}AddVdom_File(n,t,i={IsAddMode:false,ConverFileFunc:null}){this.AddFileStore(t);let{IsAddMode:u,ConverFileFunc:r}=i;return this.AddVdom_OnChange(n,n=>{this.FileExtensionCheckOption.IsCheck&&this._CheckFileExtension(n);u?n.target.value="":this.FileStore[t]=[];let i=[...n.target.files],f=i.map(n=>{let t={FileId:this._GenerateId(),File:n};return r!=null&&r(n,t),t});this.FileStore[t].push(...f);this._UpdateVueStore()}),this}AddVcol_If(n,t){return this.AddVdom_If(this.Dom.WithAttr("vc-col",n),t),this}AddVdom_If(n,t){let i=this._BaseCheck_DomEditor(n);return i.SetAttr("v-if",t),this}AddVcol_Show(n,t){return this.AddVdom_Show(this.Dom.WithAttr("vc-col",n),t),this}AddVdom_Show(n,t){let i=this._BaseCheck_DomEditor(n);return i.SetAttr("v-show",t),this}AddV_Function(n,t){return this.VueOption.methods[n]=t,this}AddV_Watch(n,t,i=false,r={}){let u={handler:t,deep:i,...r};return this.VueOption.watch[n]=u,this}AddV_Format(n,t,...i){return this.AddVdom_Format(this.Dom.WithId(n),t,i??n),this}AddVq_Format(n,t,...i){return this.AddVdom_Format(this.Dom.WithCustom(n),t,i),this}AddVdom_Format(n,t,...i){i=i.join(",");let r=this._BaseCheck_DomEditor(n);return r.SetAttr(":formatter",`${t}(${i})`),this}AddBase_Format_Date(){return this.AddV_Function(this.FuncKey_FormatDate,(n,t)=>{let i=n;n!=undefined&&(i=n.replaceAll("/","-").replaceAll("T"," "));n!=i&&this.UpdateStore(i,t)}),this}AddV_OnChange(n,t,i=null){return this.AddVdom_OnChange(this.Dom.WithId(n),t,i),this}AddVq_OnChange(n,t,i=null){return this.AddVdom_OnChange(this.Dom.WithCustom(n),t,i),this}AddVcol_OnChange(n,t,i=null){return this.AddVdom_OnChange(this.Dom.WithAttr("vc-col",n),t,i),this}AddVdom_OnChange(n,t,i=null){return this.AddVdom_On(n,"change",t,i),this}AddV_On(n,t,i,r=null){return this.AddVdom_On(this.Dom.WithId(n),t,i,r),this}AddVq_On(n,t,i,r=null){return this.AddVdom_On(this.Dom.WithCustom(n),t,i,r),this}AddVcol_On(n,t,i,r=null){return this.AddVdom_On(this.Dom.WithAttr("vc-col",n),t,i,r),this}AddVdom_On(n,t,i,r=null){i==null&&this._Throw(`Event「${t}」function cannot be null`);let e=this._BaseCheck_DomEditor(n),u=i;typeof i=="function"&&(u=this._GetRandomFuncName("Func"),this.AddV_Function(u,i));let f=u;return r!=null&&(f=`${f}(${r})`),e.SetAttr(`v-on:${t}`,f),this}AddV_Bind(n,t,i){return this.AddVdom_Bind(this.Dom.WithId(n),t,i),this}AddVcol_Bind(n,t,i){return this.AddVdom_Bind(this.Dom.WithAttr("vc-col",n),t,i),this}AddVq_Bind(n,t,i){return this.AddVdom_Bind(this.Dom.WithCustom(n),t,i),this}AddVdom_Bind(n,t,i){let r=this._BaseCheck_DomEditor(n);return r.SetAttr(`v-bind:${t}`,i),this}AddV_Click(n,t,i=null){return this.AddVdom_Click(this.Dom.WithId(n),t,i),this}AddVq_Click(n,t,i=null){return this.AddVdom_Click(this.Dom.WithCustom(n),t,i),this}AddVcol_Click(n,t,i=null){return this.AddVdom_Click(this.Dom.WithAttr("vc-col",n),t,i),this}AddVdom_Click(n,t,i=null){return t==null&&this._Throw("Click function cannot be null"),this.AddVdom_On(n,"click",t,i),this}AddV_Slot(n,t,i){return this.AddVdom_Slot(this.Dom.WithId(n),t,i),this}AddVcol_Slot(n,t,i){return this.AddVdom_Slot(this.Dom.WithAttr("vc-col",n),t,i),this}AddVq_Slot(n,t,i){return this.AddVdom_Slot(this.Dom.WithCustom(n),t,i),this}AddVdom_Slot(n,t,i){let r=this._BaseCheck_DomEditor(n);return r.SetAttr(`v-slot:${t}`,i),this}AddVdom_Model(n,t,i={VModelKey:null}){let r=this._BaseCheck_DomEditor(n);return t=this._ReCombineStoreKey(t),this.AddStore(t,null),r.ForEach(n=>{let u="v-model";this._IsNullOrEmpty(i.VModelKey)||(u+=`:${i.VModelKey}`);switch(n.type){case"datetime":case"datetime-local":case"date":this.AddVdom_Format(r,this.FuncKey_FormatDate,t,`'${t}'`);break;case"number":u="v-model.number"}r.SetElement_Attr(n,u,t)}),this}SetAttr(n,t,i){return this.SetAttrDom(this.Dom.WithId(n),t,i),this}SetAttrQ(n,t,i){return this.SetAttrDom(this.Dom.WithCustom(n),t,i),this}SetAttrCol(n,t,i){return this.SetAttrDom(this.Dom.WithAttr("vc-col",n),t,i),this}SetAttrDom(n,t,i){let r=this._BaseCheck_DomEditor(n);return r.SetAttr(t,i),this}_BaseCheck_DomEditor(n){if(n instanceof DomEditor)return n;throw new Error("error DomEditor type");}UpdateStore(n,t,i=false){return t=this._TryGetStoreKey(t),n!=null&&(n=this._TryToJson(n)),this._RCS_SetStore(t,n,this.Store,i),this._UpdateVueStore(),this}AddStore(n,t={}){return this._RCS_GetStore(n,this.Store)!=null?this:(this._RCS_SetStore(n,t,this.Store,!0),this._UpdateVueStore(),this)}AddFileStore(n){return this.FileStore[n]==null&&(this.FileStore[n]=[]),this}Files(n,t=null){let i=this.FileStore[n];if(i==null)return[];return t!=null?i.map(n=>t(n)):i.map(n=>n.File)}_RCS_GetStore(n,t){if(t==null)return null;if(!n.includes("."))return t[n];let i=n.split(".")[0],r=n.replaceAll(`${i}.`,"");return this._RCS_GetStore(r,t[i])}_RCS_SetStore(n,t,i,r){if(n.includes(".")){let u=n.split(".")[0],f=n.replaceAll(`${u}.`,"");return i[u]==null&&(i[u]={}),this._RCS_SetStore(f,t,i[u],r)}if(n in i&&!r){let r=i[n],u=t;typeof r!="object"?i[n]=u:this._BaseSetStoreObject(t,n,i)}else this._BaseSetStoreObject(t,n,i);return i[n]}_BaseSetStoreObject(n,t,i){i[t]==null||typeof i[t]=="string"||typeof n!="object"||Array.isArray(n)?Array.isArray(n)?(Array.isArray(i[t])||(i[t]=[]),i[t].length>0&&i[t].splice(0,i[t].length),i[t].push(...n)):i[t]=n:n==null?i[t]=n:this._ForEachKeyValue(n,(n,r)=>{i[t][n]=r})}_UpdateVueStore(){this.VueProxy?.$forceUpdate()}AddApi_Get(n,t={Url:null,Param:{Query:null},OnCalling:null,OnSuccess:null,OnError:null,OnComplete:null,IsUpdateStore:true}){return t.Method="GET",this._Add_Api(n,t),this}AddApi_Post(n,t={Url:null,Param:{Query:null,Body:null,Form:null,File:null},OnCalling:null,OnSuccess:null,OnError:null,OnComplete:null,IsUpdateStore:false}){return t.Method="POST",t.IsUpdateStore??=!1,this._Add_Api(n,t),this}ApiCall(n,t={Param:{Query:null,Body:null},OnCalling:null,OnSuccess:null,OnComplete:null,OnError:null,IsUpdateStore:null,_IsDefault:true}){let i=this.ApiStore[n];i==null&&this._Throw(`Api setting not found of「${n}」`);t._IsDefault==!0&&(t={});let r=t?.Param??i.Param;typeof r=="function"&&(r=r());let f=r?.Query,e=r?.Body,o=t.IsUpdateStore??i.IsUpdateStore??!0,s=this._ConvertTo_DomainUrl(i.Url,f),u={method:i.Method,headers:{"content-type":"application/json",Authorization:this._Token}};return i.Method.toUpperCase()=="POST"&&(u.body=JSON.stringify(e??{})),i.OnCalling?.call(this,u),t.OnCalling?.call(this,u),fetch(s,u).then(async n=>{if(!n.ok)throw n;let r=await this._ProcessApiReturn(n);if(o){let n=i.ApiKey;this.UpdateStore(r,n,!0)}return i.OnSuccess?.call(this,r),t?.OnSuccess?.call(this,r),r}).catch(async n=>{i.OnError?.call(this,n),t?.OnError?.call(this,n),this._Error(n.message)}).then(async n=>{i.OnComplete?.call(this,n),t?.OnComplete?.call(this,n)}),this}ApiCall_Form(n,t={Param:{Query:null,Form:null,File:null},OnCalling:null,OnSuccess:null,OnComplete:null,OnError:null,IsUpdateStore:null,_IsDefault:true}){let i=this.ApiStore[n];i==null&&this._Throw(`Api setting not found of「${n}」`);t._IsDefault==!0&&(t={});let r=t?.Param??i.Param;typeof r=="function"&&(r=r());let o=r?.Query,s=r?.Form,u=null,h=this._ConvertTo_DomainUrl(i.Url,o);u=this._ConvertTo_FormParam(s,u);let e=t?.Param?.File;e??=i.Param?.File;u=this._ConvertTo_FormFile(e,u);let f={method:"POST",body:u,headers:{Authorization:this._Token}};return i.OnCalling?.call(this,f),t.OnCalling?.call(this,f),fetch(h,f).then(async n=>{if(!n.ok)throw n;let r=await this._ProcessApiReturn(n);return i.OnSuccess?.call(this,r),t.OnSuccess?.call(this,r),r}).catch(async n=>{i.OnError?.call(this,n),t.OnError?.call(this,n)}).then(async n=>{i.OnComplete?.call(this,n),t.OnComplete?.call(this,n)}),this}_Add_Api(n,t={Url,Param,Method,OnSuccess,OnError,OnComplete,IsUpdateStore}){let i={ApiKey:n,Url:t.Url,Method:t.Method,Param:t.Param,OnSuccess:t.OnSuccess,OnError:t.OnError,OnComplete:t.OnComplete,IsUpdateStore:t.IsUpdateStore};return this.ApiStore[n]=i,this.AddStore(n),i}_ProcessApiReturn(n){let t=n.headers.get("content-type");return t&&t.includes("application/json")?n.json().then(n=>n):n.text().then(n=>n)}_ConvertTo_DomainUrl(n,t=null){let i=this._GetClearUrl(n);return this.Domain==null||i.includes("http")||(i=`${this.Domain}/${i}`),t!=null&&(i=`${i}?${this._ConvertTo_UrlQuery(t)}`),i}_ConvertTo_UrlQuery(n){if(typeof n=="string")return n;let t=[];this._ForEachKeyValue(n,(n,i)=>{t.push(`${n}=${i}`)});return t.join("&")}_ConvertTo_FormParam(n,t=null){return n==null?t:(t??=new FormData,this._Func_ConvertTo_FormParam.forEach(i=>{n=i(n,t)}),n instanceof FormData)?n:(this._ForEachKeyValue(n,(n,i)=>{t.append(n,i)}),t)}_ConvertTo_FormFile(n,t=null){if(n==null)return t;t??=new FormData;let i="Files";return Array.isArray(n)?n.forEach(n=>{t.append(i,n)}):n instanceof File?t.append(i,n):this._ForEachKeyValue(n,(n,i)=>{Array.isArray(i)?i.forEach(i=>{t.append(n,i)}):t.append(n,i)}),t}_BaseReCombine(n,t){Array.isArray(t)||(t=[t]);let i=t.filter(n=>!this._IsNullOrEmpty(n));if(i.length==0&&this._Throw("Params cannot empty"),i.length==1){let t=i[0];this._IsClearSotreKey(t)&&(i=[n,...i])}return i.join(".").replace(/^\.+|\.+$/g,"")}_ReCombineStoreKey(n){return this._BaseReCombine(this.DefaultStoreKey,n)}_ReCombineItemKey(n){return this._BaseReCombine("Item",n)}_IsClearSotreKey(n){return[".","(",")"].filter(t=>n.includes(t)).length==0}_TryToJson(n){if(typeof n=="object"||typeof n!="string")return n;try{return JSON.parse(n)}catch{return n}}_TryGetStoreKey(n){return n??this.DefaultStoreKey}_GetClearDomain(n){return n.replace(/\/+$/,"")}_GetClearUrl(n){return n.replace(/^\/+/,"")}_GetRandomFuncName(n="",t=""){let i=this._GenerateId().replaceAll("-","");return n=n.replaceAll(".",""),this._IsNullOrEmpty(n)||(i=`${n}_${i}`),this._IsNullOrEmpty(t)||(i=`${i}_${t}`),i}_CheckFileExtension(n){let t=n.target,r=[...t.files],u=t.accept;if(!this._IsNullOrEmpty(u)){let f=u.replaceAll(" ","").split(",").map(n=>n.toLowerCase().replaceAll(".","")),i=!0;for(let n=0;n<r.length;n++){let u=r[n],t=u.name;if(!t.includes(".")){i=!1;break}let e=t.split(".").pop().toLowerCase();if(!f.includes(e)){i=!1;break}}if(!i){t.value="";let n=this.FileExtensionCheckOption.ErrorMessage;this.FileExtensionCheckOption.IsAlert&&alert(n);this._Throw(n)}}}}const Model=(new VueModel).AddBase_Format_Date();class VcController extends CommonFunc{constructor(){super();this.Configs={};this.IsConfigDone=!1;this.CommandNameProp=["column","mode","default","from","value","of","to","display","key","bind","select","option","multi","checked","label"];this.DefaultVcName="Default";this.IsUseQueryWhere_VcName=!1;try{this.Model=Model}catch{this.Model=new VueModel}}get Dom(){return new DomEditor}With_VueModel(n){return this.Model=n,this}AddVc_Config(n={VcName:null,Api:{},Bind:{}}){let t=n.VcName??this.DefaultVcName;return this._Create_Config(t),this._DeepObjectExtend(this.Configs[t],n),this._ClearConfig(),this}AddVc_Config_Api(n){let t=n.VcName??this.DefaultVcName;return this._Create_Config(t),this._DeepObjectExtend(this.Configs[t].Api,n),this._ClearConfig(t),this}AddVc_Config_Bind(n,t){return this._Create_Config(n),this._DeepObjectExtend(this.Configs[n].Bind,t),this._ClearConfig(n),this}UseQueryWhere_VcName(){return this.IsUseQueryWhere_VcName=!0,this}AsNew(){return new VcController}Init(){return this.IsConfigDone||(this._SetApi(),this._SetBind(),this.IsConfigDone=!0),this}_SetApi(){return this._ForEachKeyValue(this.Configs,(n,t)=>{this._ForEachKeyValue(t.Api,(n,t)=>{this._VueModel_AddApi(n,t)})}),this}_VueModel_AddApi(n,t){let i=t.Type.toLocaleUpperCase();if(i=="GET")this.Model.AddApi_Get(n,t);else if(i=="POST")this.Model.AddApi_Post(n,t);else throw new Error("error MethodType");}_SetBind(){return this._ForEachKeyValue(this.Configs,(n,t)=>{this._ForEachKeyValue(t.Bind,(t,i)=>{this._ForEachKeyValue(i,(i,r)=>{let u=r;Array.isArray(r)||(u=[r]);u.forEach(i=>{this._VueModel_AddColumnSet(n,t,i)})})})}),this}_VueModel_AddColumnSet(n,t,i){let u=i.column,r=i.from,l=i.mode,s=i.to,a=i["of"],h=i.key,o=i.value,v=i["default"],c=i.display,f=u;if(f!=null)[".","(",")"].filter(n=>f.includes(n)).length==0&&(f=`${t}.${u}`);let e=this._DomsWhere_VcCol(n,u);switch(l){case"text":r??=f;this.Model.AddVdom_Text(e,r);break;case"input":r??=f;this.Model.AddVdom_Input(e,r,{VModelKey:h});break;case"checkbox":let l=i.multi??!1,p=i.checked??!1;r??=l==!0?t:f;this.Model.AddVdom_Checkbox(e,r,{Value:o,Multi:l,IsChecked:p});break;case"for-checkbox":let w=i.label;this.Model.AddVfor_Checkbox({Checkbox:u,From:r,To:s,Value:o,Display:c,Of:a,Label:w});break;case"select":let y=i.option,b=this.IsUseQueryWhere_VcName?Dom._QueryString_Attr_WithVcName(n,"vc-col",u):Dom._QueryString_Attr("vc-col",u),k=this.IsUseQueryWhere_VcName?Dom._QueryString_Attr_WithVcName(n,"vc-col",y):Dom._QueryString_Attr("vc-col",y);this.Model.AddVq_Select({SelectQuery:b,From:r,To:s,OptionQuery:k,Display:c,Value:o,Default:v});break;case"for":this.Model.AddVdom_For(e,r,h);break;case"file":this.Model.AddVdom_File(e,s??u);break;case"bind":this.Model.AddVdom_Bind(e,h,o)}}_Create_Config(n){this.Configs[n]==null&&(this.Configs[n]={VcName:n,Api:{},Bind:{}});let t=this.Configs[n];return"Api"in t||(t.Api={}),"Bind"in t||(t.Bind={}),this}_ClearConfig(n=null){let t=Object.keys(this.Configs);return n!=null&&(t=[n]),t.forEach(n=>{let t=this.Configs[n],i=t.Api;this._ClearConfig_Api(n,i);let r=t.Bind;this._ClearConfig_Bind(r)}),this}_ClearConfig_Api(n,t){return this._ForEachKeyValue(t,(t,i)=>{let r=["Url","Type","Param","IsUpdateStore","OnCalling","OnSuccess","OnComplete","OnError"];this._ForEachKeyValue(i,(u,f)=>{if(!r.includes(u)&&(delete i[u],u=="Bind")){if(!this._HasAnyKeys(f))return;let i={};typeof f!="object"&&this._Throw("bind set type error");i[t]={...f};this.AddVc_Config_Bind(n,i)}})}),t}_ClearConfig_Bind(n){return this._ForEachKeyValue(n,t=>{let i=n[t],r=[];this._ForEachKeyValue(i,(n,i)=>{let f=n,u=this._Analyze_CommandInfo(f);this._CheckRequired_LeftCommandInfo(u);f=u.ConvertCommand;let e=this._Analyze_RightCommandInfos(i),o=this._Convert_FullCommandInfos(u,e,t);r.splice(r.length,0,...o)});n[t]={};i=n[t];r.forEach(n=>{let t=n.column,r={};if(this.CommandNameProp.forEach(t=>{t in n&&(r[t]=n[t])}),t in i==!1)i[t]=r;else if(Array.isArray(i[t]))i[t].push(r);else{let n=i[t];i[t]=[n,r]}})}),n}_CheckRequired_LeftCommandInfo(n){switch(n.CommandName){case"column":break;default:this._Throw(`error CommandName for LeftCommand of「${n.Command}」`)}}_CheckRequired_CommandInfo(n){if(n.mode=="select"&&n.to==null&&(n.to=n.column),"column"in n==!1&&this._Throw("「column」command is required, at least one of the param needs to be set"),"mode"in n==!1&&(n.mode="text"),this._CheckRequired_Mode(n.mode),"option"in n&&n.mode!="select")throw new Error("if set「option」command,「mode」must be set「select」");if(n.mode=="select"){if("display"in n&&"option"in n==!1)throw new Error("if set「display」command for「select」mode,「option」command is required");if("value"in n&&"option"in n==!1)throw new Error("if set「value」command for「select」mode,「option」command is required");}if(n.mode=="bind"){if("value"in n==!1)throw new Error("「value」command is required for「bind」mode");if("key"in n==!1)throw new Error("「key」command is required for「bind」mode");}if(n.multi!=null){let t=n.multi;t=`${t}`.toLowerCase()=="true";n.multi=t}if(n.checked!=null){let t=n.checked;t=`${t}`.toLowerCase()=="true";n.checked=t}return n}_CheckRequired_Mode(n){switch(n){case"input":case"checkbox":case"for-checkbox":case"text":case"select":case"for":case"file":case"bind":break;default:throw new Error(`the「${n}」mode is not allow`);}}_Analyze_CommandInfo(n){let t=n;t.includes(":")||(t=`column:${t}`);let i=t.replaceAll(" ","").split(":");i.length>2&&this._Throw(`_Analyze_CommandInfo() only can analyze single command of「${n}」`);let r=this._Analyze_CommandName(i[0]),u=i[1],f=`${r}:${u}`;return{Command:n,CommandName:r,CommandValue:u,ConvertCommand:f}}_Analyze_CommandName(n){switch(n.toLowerCase()){case"from":case"f":n="from";break;case"mode":case"m":n="mode";break;case"column":case"col":n="column";break;case"value":case"val":n="value";break;case"default":case"def":n="default";break;case"of":n="of";break;case"display":case"dis":n="display";break;case"option":case"opt":n="option";break;case"to":n="to";break;case"multi":case"mul":n="multi";break;case"checked":case"chk":n="checked";break;case"label":case"lbl":n="label";break;case"key":n="key";break;default:throw new Error(`error CommandName of「${n}」`);}return n}_Analyze_RightCommandInfos(n){let t=[];Array.isArray(n)?t=n.map(n=>this._Convert_CommandInfo_CommandString(n)):(n=this._Convert_CommandInfo_CommandString(n),t=n.replaceAll(" ","").split(/[\[\]]/));return t.map(n=>{let i=n.split(";").filter(n=>!this._IsNullOrEmpty(n)),t={};return i.forEach(n=>{n.includes(":")||this._Throw("CommandName is a required parameter in CommandLine mode.");let i=this._Analyze_CommandInfo(n);t[i.CommandName]=i.CommandValue}),t})}_Convert_CommandInfo_CommandString(n){if(typeof n=="string")return n;if(typeof n=="object"){let t=[],i=Object.keys(n);for(let r=0;r<i.length;r++){let u=i[r],f=n[u];t.push(`${u}:${f}`)}return t.join(";")}throw new Error("error command type");}_Convert_FullCommandInfos(n,t,i){return t.map(t=>{let r=n.CommandName;t[r]=n.CommandValue;return this._CheckRequired_CommandInfo(t,i)})}_DomsWhere(n,...t){let i=this.Dom;return this.IsUseQueryWhere_VcName&&i.WithAttr("vc-name",n),t.forEach(n=>{i.WithCustom(n)}),i}_DomsWhere_VcCol(n,t,...i){let r=this.Dom;return this.IsUseQueryWhere_VcName&&r.WithAttr("vc-name",n),r.WithAttr("vc-col",t),i.forEach(n=>{r.WithCustom(n)}),r}}const Vc=new VcController;
//# sourceMappingURL=VueModel.full.min.js.map